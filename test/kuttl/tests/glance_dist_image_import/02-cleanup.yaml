apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |
      oc -n $NAMESPACE kustomize ../../../../config/samples/layout/single | oc delete -n $NAMESPACE -f -
  - script: |
      oc -n $NAMESPACE kustomize --load-restrictor LoadRestrictionsNone ../../../../config/samples/openstackclient | oc -n $NAMESPACE delete -f -
  - script: |
      oc -n $NAMESPACE get pvc -l service=glance -o custom-columns=NAME:.metadata.name --no-headers | xargs -n 1 oc -n $NAMESPACE delete pvc;
      for pv in $(oc -n $NAMESPACE get pv | grep "Released.*glance" | cut -f 1 -d " "); do oc -n $NAMESPACE patch pv $pv -p '{"spec":{"claimRef": null}}'; done
